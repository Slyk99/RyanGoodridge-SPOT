% close all
% clear
clc

% Loads GUI and all params - GUI NOT USED
% Run_Initializer;

% Load experimental data
load('+navigation_module/ExperimentData_RED_2025_7_24_14_6_22_4009_1.mat')
 

%% Filter IC
% x_s = [1; 2; 0; 0; 0; 0];
% x_c = [ones(3,1); 0; 0; 0];
% x_rel = globalToRelative(x_s, x_c);
% x_rel = [x_rel; x_s(3); x_s(6);]; % added theta_s and w_s

% x_s = [dataClass_rt.RED_Px_m.Data, dataClass_rt.RED_Py_m.Data, dataClass_rt.RED_Rz_rad.Data, ...
%        dataClass_rt.RED_Vx_mpers.Data, dataClass_rt.RED_Vy_mpers.Data, dataClass_rt.RED_RzD_radpers.Data]';
% x_c = [dataClass_rt.BLACK_Px_m.Data, dataClass_rt.BLACK_Py_m.Data, dataClass_rt.BLACK_Rz_rad.Data, ...
%        dataClass_rt.BLACK_Vx_mpers.Data, dataClass_rt.BLACK_Vy_mpers.Data, dataClass_rt.BLACK_RzD_radpers.Data]';
% x_rel = globalToRelative(x_s(:,3), x_c(:,3)) + [1e-2*rand([3,1]); 1e-3*rand([3,1])];

data = sim("+EKF_Testing\EKF_OPT.slx");

%%
figure
for i = 1:1:3
    subplot(3,1,i)
    plot(data.PS(:,i), 'k*')
    hold on
    plot(data.x_GNS(:,i),'r')
    grid on
end

figure
for i = 4:1:6
    subplot(3,1,i-3)
    plot(data.PS(:,i), 'k*')
    hold on
    plot(data.x_GNS(:,i),'r')
    grid on
end

figure
for i = 7:1:8
    subplot(2,1,i-6)
    plot(data.PS(:,i), 'k*')
    hold on
    plot(data.IMU(:,i-6), 'b*')
    plot(data.x_GNS(:,i),'r')
    plot(data.bias(:,i+1),'GroupDela')
    grid on
end
